= Candy Crash - UK Driving Theory Preparation Platform

image:https://img.shields.io/badge/RSR-Gold-FFD700?style=flat-square[RSR Compliance,link=./RSR_COMPLIANCE.adoc]
image:https://img.shields.io/badge/Rails-7.1.3-red?style=flat-square&logo=ruby-on-rails[Rails,link=https://rubyonrails.org/]
image:https://img.shields.io/badge/Ruby-3.3.6-red?style=flat-square&logo=ruby[Ruby,link=https://www.ruby-lang.org/]
image:https://img.shields.io/badge/License-See_LICENSE-blue?style=flat-square[License,link=./LICENSE]

A comprehensive Learning Management System (LMS) for UK driving licence preparation, built with Ruby on Rails 7 and based on the PRIMROSE protocol.

== ğŸ† RSR Compliance: Gold Tier (94%)

This project adheres to the *Rhodium Standard Repository (RSR)* framework at *Gold Tier*:

* âœ… Complete documentation (17 required files)
* âœ… RFC 9116 compliant `.well-known/security.txt`
* âœ… SPDX headers in all source files
* âœ… Comprehensive security headers (CSP, HSTS, COOP, etc.)
* âœ… Nix flakes for reproducible builds
* âœ… Podman rootless containers (Chainguard Wolfi)
* âœ… Automated testing & CI/CD (GitHub Actions)
* âœ… Security scanning (Brakeman, Bundler Audit, CodeQL)
* âœ… TPCF Governance (Tri-Perimeter Contribution Framework)
* âœ… 60+ Just automation recipes
* âœ… Git hooks with quality gates

*Current Status*: ğŸ¥‡ Gold (94% compliance) â†’ See link:./RSR_COMPLIANCE.adoc[RSR_COMPLIANCE.adoc] for details

== Features

=== Core Functionality

* âœ… *User Authentication* - Devise-powered authentication with 3 user roles (Student, Instructor, Admin)
* âœ… *Course Management* - Complete course catalog with categories, modules, and lessons
* âœ… *Quiz Engine* - Interactive quizzes with multiple-choice questions, scoring, and attempts tracking
* âœ… *Progress Tracking* - Student progress monitoring for lessons and courses
* âœ… *Achievement System* - Gamification with badges and points
* âœ… *Enrollment System* - Course enrollment and access control
* âœ… *Role-Based Dashboards* - Separate dashboards for students, instructors, and admins

=== Technical Highlights

* *Rails 7.1.3* with modern best practices
* *CSS-first design* with custom styles (410+ lines)
* *Bootstrap 5* responsive UI (foundational framework)
* *Devise* for authentication
* *Pundit* for authorization
* *Kaminari* for pagination
* *Ransack* for search and filtering
* *RSpec* test framework with SimpleCov (80% coverage minimum)
* *Active Storage* for file uploads
* *Factory Bot* for test data
* *Faker* for seed data generation
* *Just* task runner (60+ recipes)
* *Podman* rootless containers (Chainguard Wolfi)
* *Nix flakes* for reproducible builds

== Database Schema

=== Core Models

* *User* - Authentication with roles (student/instructor/admin)
* *Profile* - User profile information
* *Category* - Course categorization
* *Course* - Main course entity with pricing and metadata
* *CourseModule* - Course sections/modules
* *Lesson* - Individual lessons with content and video support
* *Question* - Quiz questions with multiple types
* *QuestionOption* - Answer options for questions
* *Quiz* - Quizzes with timing and passing score
* *QuizAttempt* - Student quiz attempts with scoring
* *QuizAnswer* - Individual question answers
* *Enrollment* - Course enrollment tracking
* *LessonProgress* - Lesson completion tracking
* *Achievement* - Achievement definitions
* *UserAchievement* - Earned achievements

== Installation

=== Prerequisites

* *Ruby 3.3.6* (runtime)
* *Just* (task runner) - link:https://github.com/casey/just#installation[Installation guide]
* *Podman* (container engine) - link:https://podman.io/getting-started/installation[Installation guide]
* *Git* (version control)
* *Bundler* (Ruby gem manager)

=== Quick Setup

[source,bash]
----
# Clone the repository
git clone https://github.com/Hyperpolymath/candy-crash.git
cd candy-crash

# Run bootstrap script (checks dependencies, installs hooks)
./bootstrap.sh

# OR manual setup:
bundle install           # Install Ruby dependencies
just db-setup           # Create and seed database
just serve              # Start development server
----

Visit `http://localhost:3000`

=== Using Just (Task Runner)

[source,bash]
----
just --list              # Show all available commands
just serve               # Start Rails server
just test                # Run test suite
just lint                # Run RuboCop
just db-reset            # Reset database
just validate-rsr        # Check RSR compliance
----

See link:./justfile[justfile] for 60+ automation recipes.

== Seed Data & Demo Accounts

The application comes with comprehensive seed data including:

* 3 categories
* 1 complete course with lessons
* 10 driving theory questions
* Practice quiz
* 3 achievements
* Multiple user accounts for testing

=== Login Credentials

*Admin Account:*

* Email: `admin@candycrash.com`
* Password: `password123`

*Instructor Account:*

* Email: `john.smith@candycrash.com`
* Password: `password123`

*Student Account:*

* Email: `student1@example.com`
* Password: `password123`

== Project Structure

----
candy-crash/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ controllers/      # Application controllers
â”‚   â”‚   â”œâ”€â”€ pages_controller.rb
â”‚   â”‚   â”œâ”€â”€ courses_controller.rb
â”‚   â”‚   â”œâ”€â”€ lessons_controller.rb
â”‚   â”‚   â”œâ”€â”€ quizzes_controller.rb
â”‚   â”‚   â”œâ”€â”€ quiz_attempts_controller.rb
â”‚   â”‚   â””â”€â”€ dashboards_controller.rb
â”‚   â”œâ”€â”€ models/           # ActiveRecord models
â”‚   â”‚   â”œâ”€â”€ user.rb
â”‚   â”‚   â”œâ”€â”€ course.rb
â”‚   â”‚   â”œâ”€â”€ lesson.rb
â”‚   â”‚   â”œâ”€â”€ question.rb
â”‚   â”‚   â”œâ”€â”€ quiz.rb
â”‚   â”‚   â””â”€â”€ ... (16 models total)
â”‚   â”œâ”€â”€ views/            # ERB templates
â”‚   â”œâ”€â”€ policies/         # Pundit authorization policies
â”‚   â””â”€â”€ helpers/          # View helpers
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ routes.rb         # Application routes
â”‚   â””â”€â”€ ...
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ migrate/          # Database migrations
â”‚   â”œâ”€â”€ seeds.rb          # Seed data
â”‚   â””â”€â”€ schema.rb         # Database schema
â””â”€â”€ spec/                 # RSpec tests
----

== Key Features Explained

=== User Roles

*Student:*

* Browse and enroll in courses
* View lessons and complete them
* Take quizzes and track attempts
* View personal dashboard with progress
* Earn achievements

*Instructor:*

* View instructor dashboard
* See enrolled students
* Access to instructor namespace (ready for course creation)

*Admin:*

* Full platform access
* User management
* Course management
* Platform analytics

=== Course Flow

. Student browses course catalog
. Student enrolls in a course
. Student accesses course modules and lessons
. Student completes lessons (progress tracked)
. Student takes quizzes to test knowledge
. System scores quizzes automatically
. Student earns achievements for milestones

=== Quiz System

* Multiple choice questions
* Configurable time limits
* Maximum attempts per quiz
* Automatic scoring
* Pass/fail threshold
* Detailed results and feedback

== Development

=== Running Tests

[source,bash]
----
# Run all tests
just test

# Run with coverage
just test-coverage

# Run specific test file
just test-file spec/models/user_spec.rb
----

=== Code Quality

[source,bash]
----
# Run RuboCop linter
just lint

# Auto-fix RuboCop issues
just lint-fix

# Run security scanner
just security

# Check for vulnerable dependencies
just audit

# Run all quality checks
just quality
----

=== Git Hooks (Hybrid System)

The project uses a *hybrid Just-based hook system*:

* Thin bash wrappers (68 lines) delegate to Just recipes
* All check logic in justfile (168 lines)
* Graceful degradation if Just not installed

*Automatic hooks* (run on git commit/push):

[source,bash]
----
./.githooks/install.sh   # Install hooks once
----

*Manual checks* (test without committing):

[source,bash]
----
just pre-commit-checks   # SPDX, linting, debugging, YAML, secrets
just pre-push-checks     # Tests, security, dependencies, migrations
----

=== Database Operations

[source,bash]
----
# Create a migration
just generate migration MigrationName

# Run migrations
just db-migrate

# Rollback last migration
just db-rollback

# Reset database
just db-reset

# Show migration status
just db-status
----

=== Container Operations (Podman)

[source,bash]
----
# Build container
just podman-build

# Run container
just podman-run

# Interactive shell
just podman-shell

# Clean up
just podman-clean
----

== PRIMROSE Protocol

This application is based on the PRIMROSE protocol for driving licence preparation. The protocol emphasizes:

* Structured learning paths
* Progressive difficulty
* Regular assessment
* Practical application
* Achievement-based motivation

== Routes Overview

=== Public Routes

* `GET /` - Home page
* `GET /courses` - Course catalog
* `GET /courses/:id` - Course details
* `GET /about` - About page

=== Student Routes (Authentication Required)

* `GET /dashboard` - Student dashboard
* `POST /courses/:id/enroll` - Enroll in course
* `GET /courses/:course_id/lessons/:id` - View lesson
* `POST /courses/:course_id/lessons/:id/complete` - Complete lesson
* `GET /courses/:course_id/quizzes/:id` - Quiz overview
* `POST /courses/:course_id/quizzes/:quiz_id/quiz_attempts` - Start quiz
* `GET /courses/:course_id/quizzes/:quiz_id/quiz_attempts/:id` - Take quiz

=== Instructor Routes

* `GET /instructor/dashboard` - Instructor dashboard
* `/instructor/courses/*` - Course management (namespaced)

=== Admin Routes

* `GET /admin/dashboard` - Admin dashboard
* `/admin/*` - Platform management (namespaced)

== Technology Decisions

=== Why These Gems?

* *Devise*: Industry standard for authentication
* *Pundit*: Policy-based authorization, easy to test
* *Kaminari*: Clean pagination with I18n support
* *Ransack*: Powerful search with minimal configuration
* *RSpec*: Better syntax than Minitest for complex tests
* *Factory Bot*: Flexible test data factories
* *Faker*: Realistic seed data generation
* *Simple Form*: DRY form builder with Bootstrap integration

== Future Enhancements

* [ ] Instructor course creation interface
* [ ] Admin panel for platform management
* [ ] Advanced analytics and reporting
* [ ] Email notifications
* [ ] Video lesson playback tracking
* [ ] Discussion forums
* [ ] Mobile app via API
* [ ] Payment integration for course purchases
* [ ] Certificate generation
* [ ] Social features (leaderboards, study groups)

== Contributing

. Fork the repository
. Create your feature branch (`git checkout -b feature/AmazingFeature`)
. Commit your changes (`git commit -m 'Add some AmazingFeature'`)
. Push to the branch (`git push origin feature/AmazingFeature`)
. Open a Pull Request

== License

This project is licensed under *GPL-3.0-or-later*.

See link:./LICENSE.txt[LICENSE.txt] for full terms. All source files include SPDX headers for license compliance.

== Documentation

* link:./SECURITY.md[SECURITY.md] - Security policy and vulnerability reporting
* link:./CONTRIBUTING.adoc[CONTRIBUTING.adoc] - Contribution guidelines
* link:./CODE_OF_CONDUCT.adoc[CODE_OF_CONDUCT.adoc] - Community standards
* link:./GOVERNANCE.adoc[GOVERNANCE.adoc] - TPCF governance model
* link:./CHANGELOG.adoc[CHANGELOG.adoc] - Version history
* link:./RSR_COMPLIANCE.adoc[RSR_COMPLIANCE.adoc] - RSR Gold compliance report
* link:./CLAUDE.adoc[CLAUDE.adoc] - AI assistant instructions

== Contact

*Project*: https://github.com/Hyperpolymath/candy-crash

*Security Issues*: See link:./public/.well-known/security.txt[.well-known/security.txt] (RFC 9116)

---

*Built with Ruby on Rails* | *RSR Gold Compliance* | *PRIMROSE Protocol*
